---
- name: Gather Fabric Device Information from Cisco Catalyst Center
  hosts: catalyst_center_hosts
  connection: local
  gather_facts: false
  vars_files:
    - "{{ VARS_FILE_PATH }}"
  vars:
    dnac_login: &dnac_login
      dnac_host: "{{ catalyst_center_host }}"
      dnac_username: "{{ catalyst_center_username }}"
      dnac_password: "{{ catalyst_center_password }}"
      dnac_verify: "{{ catalyst_center_verify }}"
      dnac_port: "{{ catalyst_center_port }}"
      dnac_version: "{{ catalyst_center_version }}"
      dnac_debug: "{{ catalyst_center_debug }}"
      dnac_log: "{{ catalyst_center_log }}"
      dnac_log_level: "{{ catalyst_center_log_level | default('INFO') }}"

  tasks:
    - name: Gather fabric device information from Cisco Catalyst Center
      cisco.dnac.fabric_devices_info_workflow_manager:
        <<: *dnac_login
        state: gathered
        config: "{{ fabric_device_info_details }}"
      register: result_fabric_device_info

    - name: Display fabric device information gathering status
      debug:
        msg:
          - "Fabric device information gathering status: {{ result_fabric_device_info.status }}"
          - "Number of query sets processed: {{ result_fabric_device_info.response | length }}"

    - name: Display fabric device information results
      debug:
        var: result_fabric_device_info

    - name: Display fabric device information summary
      debug:
        msg:
          - "Fabric Device Info workflow completed"
          - "Total devices queried: {{ result_fabric_device_info.response[0]| regex_findall(\"'([^']+)'\") | length }}"
          - "Total devices found: {{ result_fabric_device_info.response[0] }}"
          - "Status: {{ result_fabric_device_info.status }}"
      when: result_fabric_device_info.status == "success"